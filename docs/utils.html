---

title: Title


keywords: fastai
sidebar: home_sidebar



nb_path: "99_utils.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 99_utils.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="hash_files" class="doc_header"><code>hash_files</code><a href="https://github.com/JorickvdHoeven/drt/tree/master/drt/utils.py#L29" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>hash_files</code>(<strong><code>file_list</code></strong>:<code>List</code>[<code>str</code>], <strong><code>block_size</code></strong>:<code>int</code>=<em><code>10485760</code></em>, <strong><code>progressbar_min_size</code></strong>:<code>int</code>=<em><code>10737400000</code></em>)</p>
</blockquote>
<p>Takes a list of path objects and returns the SHA256 hash of
the files in the list. If any of the objects are not file objects,
this will crash. Ignores any files called 'receipt.rst' as those are
considered data intake files and not part of the work.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>file_list : List[str]
    List of strings denoting files to be hashed, the strings
    must all be valid files or this method will throw a
    ValueError exception.</p>
<p>block_size : int, optional
    Block size in bytes to read from disk a good generic
    value is 10MB as most files are smaller than 10MB and
    it means we can load whole files in at a time when
    hashing, defaults to 10_485_760 (10MB).</p>
<p>progressbar_min_size : int, optional
    Minimum size a file needs to be to get its
    own progress bar during processing. Default was chosen
    to work well on an SSD reading 400 MB/s, defaults
    to 10_737_400_000 (10GB).</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>str
    A string representation of the SHA256 hash of the files
    provided in the file list.</p>
<h2 id="Raises">Raises<a class="anchor-link" href="#Raises"> </a></h2><p>ValueError
    The strings passed in the file_list need to be valid file objects
    in the file system. Currently only windows and Posix filesystems
    are supported. This may change in future.</p>
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2><blockquote><blockquote><blockquote><p>files = sorted([f for f in Path.cwd().iterdir() if not f.is_dir()])
hash_files(files)
'ceafa67639bab8e30b0b73955668edec73c1ff2b190db60d74da419144e6c0b0'</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="process_data_group" class="doc_header"><code>process_data_group</code><a href="https://github.com/JorickvdHoeven/drt/tree/master/drt/utils.py#L111" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>process_data_group</code>(<strong><code>folder</code></strong>:<code>Path</code>, <strong><code>type</code></strong>:<code>str</code>, <strong><code>light</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Return the system fields for a data group folder.</p>
<p>If the data group is a delivery type, then this only looks at the
data folder in it, if it is any other type it looks at the whole folder.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>folder : Path
    The location to get metadata for.</p>
<p>type : DataIntakeEnv
    The type of data group. ['delivery', 'raw_data', 'dataset']</p>
<p>light : bool, optional
    If set skip the hashing</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>dict
    A dict of the following five metadata elements calculated:</p>

<pre><code>- name : Name of the folder of the data group
- type : The type of the data group processed
- last_update : The current date and time
- size : The size of the data on disk
- num_files : The number of data files.
- group_hash : A SHA256 hash of all the data in the folder
- group_last_modified : The maximum date of created, and modified for all files

</code></pre>
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2><blockquote><blockquote><blockquote><p>process_data_group(delivery, dm.Delivery)
{
    "name" : '2020_11_01_test_delivery',
    "type" : 'delivery',
    "last_update" : datetime.datetime(2020, 11, 15, 3, 51, 33, 851325),
    "size" : 5465684,
    "num_files" : 4,
    "group_hash" : 'ceafa67639bab8e30b0b73955668edec73c1ff2b190db60d74da419144e6c0b0',
    "group_last_modified" : datetime.datetime(2020, 11, 15, 3, 31, 36),
}</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="count_data_group_components" class="doc_header"><code>count_data_group_components</code><a href="https://github.com/JorickvdHoeven/drt/tree/master/drt/utils.py#L201" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>count_data_group_components</code>(<strong><code>data_group</code></strong>:<code>Path</code>, <strong><code>data_extensions</code></strong>:<code>list</code>, <strong><code>report_extensions</code></strong>:<code>list</code>, <strong><code>script_extensions</code></strong>:<code>list</code>)</p>
</blockquote>
<p>A utility method to analyze a folder to determine which data
it contains and whether those have the three requisite elements,
generation script, data, and report. It relies on certain
conventions about the folder which must be followed:</p>
<ol>
<li>Each data respresentation is stored in a folder, files in
 the root of the passed folder will be ignored.</li>
<li>Folders starting with "In_Progress" or "." will be ignored.</li>
<li>In each data representation folder there are three entries
 more won't cause an error but should be avoided</li>
<li>Report types have extensions:
<pre><code> ['report','md','html','pptx','docx', ...]
</code></pre>
 with the initial report extension added to a folder containing
 report files if there is more than 1 report file needed.</li>
<li>Data types have extensions:
<pre><code> ['data','parquet','hdf5', ...]
</code></pre>
 with the initial data extension being used for folders in the
 declaration which allows the data to be spread over multiple
 files.</li>
<li>Script types have extensions:
<pre><code> ['script','ipynb','py','r','jl','sh', ...]
</code></pre>
 Where the first extension can be applied to a folder if more
 than one file was needed to process the data.</li>
</ol>
<p>This analyzer will look only for the extensions listed and report
how many of each of the types of files/folders exist in the root
of the provided folder.</p>
<h2 id="Parameters">Parameters<a class="anchor-link" href="#Parameters"> </a></h2><p>folder : Path
    A folder containing folders of data representations</p>
<p>TODO add extension list parameters</p>
<h2 id="Returns">Returns<a class="anchor-link" href="#Returns"> </a></h2><p>pd.DataFrame
    A table listing all the data representations which appear
    in the root of the folder.</p>
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2><blockquote><blockquote><blockquote><p>analyze_folder(folder)
{
    'data'   : 1,
    'report' : 0,
    'script' : 1
}</p>
</blockquote>
</blockquote>
</blockquote>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

</div>
 

